---
title: "Untitled"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(ggmap)
data.port=read.table(file="C:/Users/TSR/Desktop/高統r/airports.dat",sep=",")
data.line=read.table(file="C:/Users/TSR/Desktop/高統r/routes .dat",sep=",")
library(stringr)

portinchina <- str_detect(data.port[,'V4'], "Taiwan")
chinaport <- data.port[portinchina,]
data.port= data.port[,c('V3','V5','V7','V8','V9')]
names(data.port) <- c('city','code','lan','lon','att')
chinaport <-chinaport[chinaport$V5!='',
                      c('V3','V5','V7','V8','V9')]
names(chinaport) <- c('city','code','lan','lon','att')

lineinchina <- data.line[,'V3'] %in% chinaport$code 
chinaline <- data.line[lineinchina,c('V3','V5','V9')]
names(chinaline) <- c('source','destination','equipment')
 

findposition <- function(code) {
    find <- chinaport$code==code
    x <- chinaport[find,'lon']
    y <- chinaport[find,'lan']
    return(data.frame(x,y))
}
 
too <- function(code) {
    find <- data.port$code==code
    x <- data.port[find,'lon']
    y <- data.port[find,'lan']
    return(data.frame(x,y))
}


from <- lapply(as.character(chinaline$source),findposition)
from <- do.call('rbind',from)
from$group <- 1:dim(from)[1]
names(from) <- c('lon','lan','group')
 
to <- lapply(as.character(chinaline$destination),too)
to <- do.call('rbind',to)
to$group <-1:dim(to)[1]
names(to) <-c('lon','lan','group')
data.line <- rbind(from,to)

ggmap(get_googlemap(center = 'taiwan', zoom=3,size=c(1000,1000),
                    maptype='roadmap'),extent='device')+
    geom_point(data=chinaport,aes(x=lon,y=lan),
               colour = 'red4',alpha=0.8)+
    geom_line(data=data.line,aes(x=lon,y=lan,group=group),
              size=0.1,alpha=1,color='red4')


```

You can also embed plots, for example:

```{r, echo=FALSE}
plot(cars)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
